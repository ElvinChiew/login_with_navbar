<!DOCTYPE html>
<html lang="en" class="[scrollbar-gutter:stable]">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content={get_csrf_token()} />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />

    <.live_title default="Bb" suffix=" · Phoenix Framework">
      {assigns[:page_title]}
    </.live_title>

    <link phx-track-static rel="stylesheet" href={~p"/assets/app.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/app.js"}></script>
  </head>

  <body class="bg-white w-screen">

    <!-- Sticky Navbar -->
    <nav class="sticky top-0 w-full bg-slate-800 z-10 px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
      <%= if @current_user do %>
        <!-- Left: Hamburger Toggle -->
        <div class="flex items-center gap-4">
          <label
            for="menu-toggle"
            class="cursor-pointer text-2xl font-medium text-white hover:text-zinc-300 transition z-30 relative border border-white px-3 py-3 rounded-md">
            ☰
          </label>
        </div>

        <!-- Right: Profile Menu -->
<!-- Hidden Checkbox as Toggle -->
<div class="relative">
  <input type="checkbox" id="user-menu-toggle" class="peer hidden" />

  <!-- Clickable Avatar (Label for Checkbox) -->
  <label for="user-menu-toggle" class="cursor-pointer">
    <img
      class="size-8 rounded-full bg-gray-800"
      src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
      alt="User avatar" />
  </label>

  <!-- Dropdown Menu -->
  <div
    class="absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white py-1 shadow-lg ring-1 ring-black/5
           opacity-0 invisible peer-checked:visible peer-checked:opacity-100 transition ease-out duration-150">
    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
      {@current_user.name}
    </a>
    <a href={~p"/users/settings"} class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
      Settings
    </a>
    <.link href={~p"/users/log_out"} method="delete" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
      Log out
    </.link>
  </div>
</div>

      <% else %>
        <!-- Right: Login/Register -->
        <div class="flex items-center gap-4">
          <.link href={~p"/users/register"} class="text-sm font-semibold text-white hover:text-zinc-300">
            Register
          </.link>
          <.link href={~p"/users/log_in"} class="text-sm font-semibold text-white hover:text-zinc-300">
            Log in
          </.link>
        </div>
      <% end %>
    </nav>

    <!-- Sidebar (Only shown if logged in) -->
    <%= if @current_user do %>
      <input type="checkbox" id="menu-toggle" class="peer hidden" />

      <aside class="fixed top-0 left-0 h-screen bg-slate-800 shadow-lg z-40 transition-all duration-300 ease-in-out w-64 peer-checked:w-0 overflow-hidden">
        <div class="flex items-center justify-between px-4 py-4 border-b border-slate-700">
          <h2 class="text-white text-xl font-semibold">Dashboard</h2>
          <label for="menu-toggle" class="cursor-pointer text-white text-2xl hover:text-gray-300 transition">
            &times;
          </label>
        </div>

        <ul class="mt-4 px-4 space-y-3">
          <li>
            <.link navigate={~p"/"} class={[@conn.request_path == ~p"/" && "bg-slate-700 text-white", "flex items-center gap-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-slate-600 transition"]}>
              <i class="fa fa-home"></i> Home
            </.link>
          </li>
          <li>
            <.link navigate={~p"/books/extra"} class={[@conn.request_path == ~p"/books/extra" && "bg-slate-700 text-white", "flex items-center gap-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-slate-600 transition"]}>
              <i class="fa fa-plus-circle"></i> Extra
            </.link>
          </li>
          <li>
            <.link navigate={~p"/users/settings"} class={[@conn.request_path == ~p"/users/settings" && "bg-slate-700 text-white", "flex items-center gap-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-slate-600 transition"]}>
              <i class="fa fa-wrench"></i> Settings
            </.link>
          </li>

          <!-- Dropdown -->
          <li class="relative">
            <input type="checkbox" id="extra-toggle" class="hidden peer" />
            <label for="extra-toggle" class="flex items-center justify-between px-4 py-2 text-gray-300 rounded-lg hover:bg-slate-600 cursor-pointer transition">
              <span class="flex items-center gap-3">
                <i class="fa fa-cubes"></i> Dropdown Menu
              </span>
              <i class="fa fa-chevron-down"></i>
            </label>
          <ul class="ml-6 mt-2 hidden peer-checked:block space-y-2 text-sm">
            <li>
              <.link navigate={~p"/books/bookpage"} class={[@conn.request_path == ~p"/books/bookpage" && "bg-slate-700 text-white", "flex items-center gap-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-slate-600 transition"]}>
                Books Pagination
              </.link>
            </li>

            <%= if @current_user.role == "admin" do %>
              <li>
                <.link navigate={~p"/books"} class={[@conn.request_path == ~p"/books" && "bg-slate-700 text-white", "flex items-center gap-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-slate-600 transition"]}>
                  Books
                </.link>
              </li>
            <% end %>
          </ul>
          </li>

          <%= if @current_user.role == "admin" do %>
            <li>
              <.link navigate={~p"/item_stocks"} class={[@conn.request_path == ~p"/item_stocks" && "bg-slate-700 text-white", "flex items-center gap-3 px-4 py-2 rounded-lg text-gray-300 hover:bg-slate-600 transition"]}>
                <i class="fa fa-boxes"></i> Item Stocks
              </.link>
            </li>
          <% end %>
        </ul>
      </aside>
    <% end %>

    <!-- Main Content -->
    {@inner_content}
  </body>
</html>
